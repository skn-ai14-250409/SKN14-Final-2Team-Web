{% extends "scentpick/base.html" %}
{% block title %}ë§ì¶¤ ì¶”ì²œ - ScentPick{% endblock %}
{% block content %}

<div class="page-container" style="max-width:1400px;margin:0 auto;padding:20px;">
  <div class="page-header" style="text-align:center;margin-bottom:40px;">
    <h1 style="color:#1e3a8a;font-size:32px;font-weight:900;margin-bottom:8px;">ë§ì¶¤ í–¥ìˆ˜ ì¶”ì²œ</h1>
    <p style="color:#64748b;font-size:16px;margin:0;">ë‹¹ì‹ ë§Œì„ ìœ„í•œ íŠ¹ë³„í•œ í–¥ìˆ˜ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
  </div>

  <!-- ì¶”ì²œ ì„¹ì…˜ -->
  <div class="recommend-section" style="margin-bottom:60px;">
    <!-- ì˜¤ëŠ˜ì˜ ë‚ ì”¨ ê¸°ë°˜ ì¶”ì²œ -->
    <div class="recommendation-card" style="background:linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);border-radius:24px;padding:32px;margin-bottom:32px;box-shadow:0 20px 64px rgba(30,64,175,0.3);position:relative;overflow:hidden;">
      <!-- ë°°ê²½ íŒ¨í„´ -->
      <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\"><g fill=\"none\" fill-rule=\"evenodd\"><g fill=\"%23ffffff\" fill-opacity=\"0.05\"><circle cx=\"7\" cy=\"7\" r=\"7\"/><circle cx=\"53\" cy=\"53\" r=\"7\"/></g></svg>
      </div>
      

      <div style="position:relative;z-index:1;">
        <h2 style="color:white;margin-bottom:24px;font-size:26px;font-weight:800;text-align:center;">ğŸŒ¤ï¸ ì˜¤ëŠ˜ì˜ ë‚ ì”¨ ì¶”ì²œ</h2>

        <div class="weather-info" style="background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);padding:24px;border-radius:16px;margin-bottom:28px;border:1px solid rgba(255,255,255,0.2);">
          <div style="display:flex;align-items:center;gap:20px;margin-bottom:16px;">
            <div style="font-size:48px;filter:drop-shadow(0 4px 8px rgba(0,0,0,0.1));">{{ weather_emoji|default:"ğŸŒ¤ï¸" }}</div>
            <div>
              <div style="font-size:24px;font-weight:800;color:white;margin-bottom:4px;">
                {{ weather_line1|default:"ë§‘ìŒ, -Â°C" }}
              </div>
              <div style="color:rgba(255,255,255,0.8);font-size:16px;">
                {{ weather_line2|default:"ìŠµë„ -%, ë°”ëŒ -" }}
              </div>
            </div>
          </div>
          <p style="color:rgba(255,255,255,0.95);margin:0;font-size:16px;line-height:1.5;">
            {{ weather_tip|default:"ì˜¤ëŠ˜ ê¸°ë¶„ì— ë§ëŠ” í–¥ì„ ê°€ë³ê²Œ ì‹œí–¥í•´ ë³´ì„¸ìš” :)" }}
          </p>
        </div>

        <!-- ë‚ ì”¨ ê¸°ë°˜ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ -->
        <div class="products-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;">
          {% for p in perfumes %}
            {% if p.detail_url %}
              <a href="{{ p.detail_url }}" target="_blank" rel="noopener" class="product-card weather-card">
            {% else %}
              <div class="product-card weather-card">
            {% endif %}

                <div class="product-image" style="position:relative;width:100%;aspect-ratio:1/1;overflow:hidden;border-radius:16px;background:#f8fafc;box-shadow:0 8px 24px rgba(0,0,0,0.15);">
                  {% if p.image_url %}
                    <img src="{{ p.image_url }}"
                         alt="{{ p.brand }} {{ p.name }}"
                         loading="lazy" decoding="async"
                         onerror="this.onerror=null;this.src='/static/img/placeholder.png';"
                         style="width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s ease;">
                  {% else %}
                    <img src="/static/img/placeholder.png"
                         alt="no image"
                         style="width:100%;height:100%;object-fit:cover;display:block;">
                  {% endif %}
                </div>

                <div class="product-info" style="margin-top:16px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);padding:16px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.1);">
                  <div class="product-brand" style="font-weight:800;color:#1e3a8a;font-size:15px;margin-bottom:4px;">
                    {{ p.brand }}
                  </div>
                  <div class="product-name" style="color:#475569;font-size:14px;margin-bottom:8px;line-height:1.3;">
                    {{ p.name }}
                  </div>
                  {% if p.price %}
                    <div class="product-price" style="color:#0f766e;font-weight:700;font-size:16px;">â‚©{{ p.price }}</div>
                  {% endif %}
                </div>

            {% if p.detail_url %}
              </a>
            {% else %}
              </div>
            {% endif %}
          {% empty %}
            <div style="color:rgba(255,255,255,0.8);text-align:center;grid-column:1/-1;padding:40px;background:rgba(255,255,255,0.1);border-radius:16px;">
              <div style="font-size:48px;margin-bottom:16px;">ğŸ”</div>
              ì¡°ê±´ì— ë§ëŠ” ì¶”ì²œ í–¥ìˆ˜ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ê³„ì ˆ ë§ì¶¤ ì¶”ì²œ -->
    <div class="recommendation-card" style="background:linear-gradient(135deg, #1e40af 0%, #2563eb 50%, #3b82f6 100%);border-radius:24px;padding:32px;box-shadow:0 20px 64px rgba(30,64,175,0.25);position:relative;overflow:hidden;">
      <!-- ë°°ê²½ íŒ¨í„´ -->
      <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 40 40\"><g fill=\"none\" fill-rule=\"evenodd\"><g fill=\"%23ffffff\" fill-opacity=\"0.08\"><rect width=\"2\" height=\"40\" x=\"19\"/><rect width=\"40\" height=\"2\" y=\"19\"/></g></svg></div>
      
      <div style="position:relative;z-index:1;">
        <h2 style="color:white;margin-bottom:24px;font-size:26px;font-weight:800;text-align:center;">ğŸ‚ {{ season_title|default:"ì§€ê¸ˆ ê³„ì ˆ ì¶”ì²œ Top 3" }}</h2>
        
        <div class="season-info" style="background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);padding:20px;border-radius:16px;margin-bottom:28px;border:1px solid rgba(255,255,255,0.2);">
          <p style="color:rgba(255,255,255,0.95);margin:0;font-size:16px;text-align:center;line-height:1.5;">{{ season_tip|default:"ìš”ì¦˜ ê³„ì ˆì— ì–´ìš¸ë¦¬ëŠ” í–¥ì„ ê³¨ëì–´ìš”." }}</p>
        </div>

        <div class="products-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;">
          {% for p in seasonal_perfumes %}
            {% if p.detail_url %}
              <a href="{{ p.detail_url }}" target="_blank" rel="noopener" class="product-card season-card">
            {% else %}
              <div class="product-card season-card">
            {% endif %}

                <div class="product-image" style="position:relative;width:100%;aspect-ratio:1/1;overflow:hidden;border-radius:16px;background:#f8fafc;box-shadow:0 8px 24px rgba(0,0,0,0.15);">
                  {% if p.image_url %}
                    <img src="{{ p.image_url }}"
                         alt="{{ p.brand }} {{ p.name }}"
                         loading="lazy" decoding="async"
                         onerror="this.onerror=null;this.src='/static/img/placeholder.png';"
                         style="width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s ease;">
                  {% else %}
                    <img src="/static/img/placeholder.png"
                         alt="no image"
                         style="width:100%;height:100%;object-fit:cover;display:block;">
                  {% endif %}
                </div>

                <div class="product-info" style="margin-top:16px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);padding:16px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.1);">
                  <div class="product-brand" style="font-weight:800;color:#1e3a8a;font-size:15px;margin-bottom:4px;">
                    {{ p.brand }}
                  </div>
                  <div class="product-name" style="color:#475569;font-size:14px;margin-bottom:8px;line-height:1.3;">
                    {{ p.name }}
                  </div>
                  {% if p.price %}
                    <div class="product-price" style="color:#0f766e;font-weight:700;font-size:16px;">â‚©{{ p.price }}</div>
                  {% endif %}
                </div>

            {% if p.detail_url %}
              </a>
            {% else %}
              </div>
            {% endif %}
          {% empty %}
            <div style="color:rgba(255,255,255,0.8);text-align:center;grid-column:1/-1;padding:40px;background:rgba(255,255,255,0.1);border-radius:16px;">
              <div style="font-size:48px;margin-bottom:16px;">ğŸŒ¸</div>
              ì§€ê¸ˆ ê³„ì ˆì— ë§ëŠ” ì¶”ì²œì´ ì•„ì§ ì—†ì–´ìš”.
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- í–¥ìˆ˜ ì›”ë“œì»µ ì„¹ì…˜ -->
  <div class="worldcup-section" style="background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 50%, #bfdbfe 100%);border-radius:28px;padding:40px;box-shadow:0 24px 80px rgba(59,130,246,0.15);position:relative;overflow:hidden;">
    <!-- ë°°ê²½ ì¥ì‹ -->
    <div style="position:absolute;top:-50px;right:-50px;width:200px;height:200px;background:linear-gradient(45deg, #3b82f6, #60a5fa);border-radius:50%;opacity:0.1;"></div>
    <div style="position:absolute;bottom:-30px;left:-30px;width:150px;height:150px;background:linear-gradient(45deg, #1e40af, #3b82f6);border-radius:50%;opacity:0.08;"></div>
    
    <div style="position:relative;z-index:1;">
      <div class="worldcup-header" style="text-align:center;margin-bottom:40px;">
        <h2 style="color:#1e3a8a;font-size:32px;font-weight:900;margin-bottom:12px;">ğŸ® í–¥ìˆ˜ ì›”ë“œì»µ</h2>
        <p style="color:#64748b;font-size:18px;margin:0;">ë‚˜ë§Œì˜ ì·¨í–¥ì„ ì°¾ì•„ê°€ëŠ” ì¬ë¯¸ìˆëŠ” ì—¬ì •</p>
      </div>
      
      <div style="display:grid;grid-template-columns:400px 1fr;gap:40px;">
        <!-- ì™¼ìª½: ë‹¨ê³„ë³„ ì§ˆë¬¸ì§€ -->
        <div class="quiz-panel" style="background:rgba(255,255,255,0.9);backdrop-filter:blur(20px);border:2px solid rgba(59,130,246,0.2);border-radius:20px;padding:32px;height:fit-content;box-shadow:0 12px 40px rgba(59,130,246,0.1);">
          <div class="quiz-header" style="text-align:center;margin-bottom:28px;">
            <div style="width:80px;height:80px;background:linear-gradient(135deg, #3b82f6, #1e40af);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;box-shadow:0 8px 24px rgba(59,130,246,0.3);">
              <span style="font-size:36px;">ğŸ¯</span>
            </div>
            <h3 style="color:#1e3a8a;font-size:20px;font-weight:800;margin:0;">ì·¨í–¥ ì°¾ê¸°</h3>
          </div>
          
          <form method="get" action="{% url 'scentpick:recommend' %}" id="quiz-form">
            <!-- ì§ˆë¬¸ 1: ì„±ë³„ -->
            <div class="quiz-step active" id="step-1" style="display:block;">
              <div class="question-header" style="text-align:center;margin-bottom:24px;">
                <div style="color:#3b82f6;font-size:18px;font-weight:700;margin-bottom:8px;">1/3</div>
                <h4 style="color:#1e3a8a;font-size:18px;font-weight:700;margin:0;">ì–´ë–¤ ì„±ë³„ì˜ í–¥ìˆ˜ë¥¼ ì°¾ê³  ê³„ì‹ ê°€ìš”?</h4>
              </div>
              
              <div style="display:grid;gap:12px;">
                <label class="quiz-option" data-value="ë‚¨ì„±" style="display:flex;align-items:center;gap:16px;padding:16px 20px;border:2px solid #e5e7eb;border-radius:16px;cursor:pointer;background:white;transition:all 0.3s;">
                  <div style="width:50px;height:50px;background:linear-gradient(135deg, #60a5fa, #3b82f6);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;">ğŸ‘¨</div>
                  <div>
                    <div style="font-weight:700;color:#1e3a8a;font-size:16px;">ë‚¨ì„±</div>
                    <div style="color:#64748b;font-size:14px;">ê¹”ë”í•˜ê³  ì‹œì›í•œ í–¥</div>
                  </div>
                </label>
                <label class="quiz-option" data-value="ì—¬ì„±" style="display:flex;align-items:center;gap:16px;padding:16px 20px;border:2px solid #e5e7eb;border-radius:16px;cursor:pointer;background:white;transition:all 0.3s;">
                  <div style="width:50px;height:50px;background:linear-gradient(135deg, #f472b6, #ec4899);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;">ğŸ‘©</div>
                  <div>
                    <div style="font-weight:700;color:#1e3a8a;font-size:16px;">ì—¬ì„±</div>
                    <div style="color:#64748b;font-size:14px;">ìš°ì•„í•˜ê³  ì„¬ì„¸í•œ í–¥</div>
                  </div>
                </label>
                <label class="quiz-option" data-value="ë‚¨ë…€ê³µìš©" style="display:flex;align-items:center;gap:16px;padding:16px 20px;border:2px solid #e5e7eb;border-radius:16px;cursor:pointer;background:white;transition:all 0.3s;">
                  <div style="width:50px;height:50px;background:linear-gradient(135deg, #34d399, #10b981);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;">ğŸ‘«</div>
                  <div>
                    <div style="font-weight:700;color:#1e3a8a;font-size:16px;">ë‚¨ë…€ê³µìš©</div>
                    <div style="color:#64748b;font-size:14px;">ëˆ„êµ¬ë‚˜ ì¢‹ì•„í•˜ëŠ” í–¥</div>
                  </div>
                </label>
              </div>
            </div>

            <!-- ì§ˆë¬¸ 2: ì–´ì½”ë“œ -->
            <div class="quiz-step" id="step-2" style="display:none;">
              <div class="question-header" style="text-align:center;margin-bottom:24px;">
                <div style="color:#3b82f6;font-size:18px;font-weight:700;margin-bottom:8px;">2/3</div>
                <h4 style="color:#1e3a8a;font-size:18px;font-weight:700;margin:0;">ì–´ë–¤ í–¥ì˜ ëŠë‚Œì„ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h4>
              </div>
              
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                {% for opt in accord_options %}
                  <label class="quiz-option" data-value="{{ opt }}" style="display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px;border:2px solid #e5e7eb;border-radius:16px;cursor:pointer;background:white;transition:all 0.3s;text-align:center;">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg, #a78bfa, #8b5cf6);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸŒ¸</div>
                    <div style="font-weight:600;color:#1e3a8a;font-size:14px;">{{ opt }}</div>
                  </label>
                {% endfor %}
              </div>
              
              <button type="button" class="prev-btn" style="margin-top:20px;padding:12px 24px;border:2px solid #e5e7eb;border-radius:12px;background:white;color:#64748b;font-weight:600;cursor:pointer;width:100%;">â† ì´ì „</button>
            </div>

            <!-- ì§ˆë¬¸ 3: ì‹œê°„ëŒ€ -->
            <div class="quiz-step" id="step-3" style="display:none;">
              <div class="question-header" style="text-align:center;margin-bottom:24px;">
                <div style="color:#3b82f6;font-size:18px;font-weight:700;margin-bottom:8px;">3/3</div>
                <h4 style="color:#1e3a8a;font-size:18px;font-weight:700;margin:0;">ì–¸ì œ ì‚¬ìš©í•˜ì‹¤ ì˜ˆì •ì¸ê°€ìš”?</h4>
              </div>
              
              <div style="display:grid;gap:16px;">
                <label class="quiz-option" data-value="day" style="display:flex;align-items:center;gap:16px;padding:20px;border:2px solid #e5e7eb;border-radius:16px;cursor:pointer;background:white;transition:all 0.3s;">
                  <div style="width:60px;height:60px;background:linear-gradient(135deg, #fbbf24, #f59e0b);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;">ğŸŒ…</div>
                  <div>
                    <div style="font-weight:700;color:#1e3a8a;font-size:16px;">ë‚® ì‹œê°„ëŒ€</div>
                    <div style="color:#64748b;font-size:14px;">ê°€ë³ê³  ìƒì¾Œí•œ ì¼ìƒìš© í–¥ìˆ˜</div>
                  </div>
                </label>
                <label class="quiz-option" data-value="night" style="display:flex;align-items:center;gap:16px;padding:20px;border:2px solid #e5e7eb;border-radius:16px;cursor:pointer;background:white;transition:all 0.3s;">
                  <div style="width:60px;height:60px;background:linear-gradient(135deg, #6366f1, #4f46e5);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;">ğŸŒ™</div>
                  <div>
                    <div style="font-weight:700;color:#1e3a8a;font-size:16px;">ë°¤ ì‹œê°„ëŒ€</div>
                    <div style="color:#64748b;font-size:14px;">ê¹Šê³  ë§¤í˜¹ì ì¸ íŠ¹ë³„í•œ í–¥ìˆ˜</div>
                  </div>
                </label>
              </div>
              
              <div style="display:flex;gap:12px;margin-top:20px;">
                <button type="button" class="prev-btn" style="flex:1;padding:12px 24px;border:2px solid #e5e7eb;border-radius:12px;background:white;color:#64748b;font-weight:600;cursor:pointer;">â† ì´ì „</button>
                <button type="submit" class="submit-btn" style="flex:2;padding:12px 24px;border:none;border-radius:12px;background:linear-gradient(135deg, #3b82f6, #1e40af);color:white;font-weight:700;cursor:pointer;box-shadow:0 4px 16px rgba(59,130,246,0.4);">âœ¨ ê²°ê³¼ ë³´ê¸°</button>
              </div>
            </div>

            <!-- ìˆ¨ê²¨ì§„ inputë“¤ -->
            <input type="hidden" name="g" id="gender-input">
            <input type="hidden" name="a" id="accord-input">
            <input type="hidden" name="t" id="time-input">

            {% if worldcup_candidates|length == 0 and wc_selected_gender and wc_selected_accord and wc_selected_time %}
              <div style="color:#ef4444;text-align:center;padding:16px;background:rgba(239,68,68,0.1);border-radius:12px;font-size:14px;margin-top:16px;">ì¡°ê±´ì— ë§ëŠ” í›„ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì¡°í•©ìœ¼ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</div>
            {% endif %}
          </form>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì›”ë“œì»µ UI -->
        <div class="tournament-panel" style="background:rgba(255,255,255,0.9);backdrop-filter:blur(20px);border:2px solid rgba(59,130,246,0.2);border-radius:20px;padding:32px;box-shadow:0 12px 40px rgba(59,130,246,0.1);">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;">
            <h3 style="margin:0;color:#1e3a8a;font-size:22px;font-weight:800;">ğŸ† í† ë„ˆë¨¼íŠ¸</h3>
            {% if worldcup_candidates|length >= 2 %}
              <button id="wc-start" style="padding:12px 20px;border:2px solid #3b82f6;border-radius:12px;background:linear-gradient(135deg, #3b82f6, #1e40af);color:white;cursor:pointer;font-weight:700;transition:all 0.3s;box-shadow:0 4px 16px rgba(59,130,246,0.3);">
                ğŸš€ ê²Œì„ ì‹œì‘
              </button>
            {% endif %}
          </div>

          {% if worldcup_candidates %}
            <!-- í›„ë³´ ë¯¸ë¦¬ë³´ê¸° -->
            <div id="wc-candidate-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px;">
              {% for c in worldcup_candidates %}
                <div class="candidate-card" style="border:2px solid #e5e7eb;border-radius:16px;overflow:hidden;background:white;transition:all 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.1);">
                  <div style="aspect-ratio:1/1;background:#f8fafc;overflow:hidden;">
                    <img src="{{ c.image_url }}" alt="{{ c.brand }} {{ c.name }}"
                         style="width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.3s;">
                  </div>
                  <div style="padding:12px;">
                    <div style="font-weight:700;color:#1e3a8a;font-size:13px;margin-bottom:4px;line-height:1.2;">{{ c.brand }}</div>
                    <div style="color:#64748b;font-size:12px;margin-bottom:8px;line-height:1.2;">{{ c.name }}</div>
                    <div style="color:#9ca3af;font-size:10px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.3;">
                      {{ c.description }}
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>

            <!-- ë§¤ì¹˜ ì§„í–‰ ì˜ì—­ -->
            <div id="wc-stage" style="display:none;margin-top:24px;">
              <div id="wc-round-label" style="font-weight:800;color:#1e3a8a;margin-bottom:20px;text-align:center;font-size:20px;">Round 8</div>
              <div id="wc-match" style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
                <!-- ë‘ ì¹´ë“œê°€ JSë¡œ ì£¼ì…ë¨ -->
              </div>
            </div>

          {% else %}
            <div style="color:#64748b;text-align:center;padding:60px 20px;background:rgba(59,130,246,0.05);border-radius:16px;border:2px dashed #bfdbfe;">
              <div style="font-size:64px;margin-bottom:20px;">ğŸ¯</div>
              <div style="font-size:18px;font-weight:600;margin-bottom:8px;color:#1e3a8a;">ì›”ë“œì»µ ì¤€ë¹„ ì™„ë£Œ!</div>
              <div style="font-size:14px;">ì™¼ìª½ ì§ˆë¬¸ì— ë‹µí•˜ê³  ë‚˜ë§Œì˜ í–¥ìˆ˜ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.product-card {
  text-decoration: none !important;
  color: inherit;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  display: block;
}

.weather-card:hover,
.season-card:hover {
  transform: translateY(-8px) scale(1.02);
}

.weather-card:hover .product-image img,
.season-card:hover .product-image img {
  transform: scale(1.1);
}

.quiz-option {
  transition: all 0.3s ease !important;
}

.quiz-option:hover {
  border-color: #3b82f6 !important;
  background: #eff6ff !important;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(59,130,246,0.2) !important;
}

.quiz-option.selected {
  border-color: #1e40af !important;
  background: linear-gradient(135deg, #dbeafe, #bfdbfe) !important;
  box-shadow: 0 8px 24px rgba(59,130,246,0.3) !important;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(59,130,246,0.6) !important;
}

.candidate-card:hover {
  transform: translateY(-4px);
  border-color: #3b82f6 !important;
  background: #eff6ff !important;
  box-shadow: 0 12px 32px rgba(59,130,246,0.2) !important;
}

.candidate-card:hover img {
  transform: scale(1.05);
}

#wc-start:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(59,130,246,0.5) !important;
}

.prev-btn:hover {
  border-color: #3b82f6 !important;
  background: #eff6ff !important;
  color: #1e40af !important;
}

.quiz-step {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.progress-bar {
  width: 100%;
  height: 6px;
  background: #e5e7eb;
  border-radius: 3px;
  margin-bottom: 24px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #3b82f6, #1e40af);
  border-radius: 3px;
  transition: width 0.5s ease;
}
</style>

{% endblock content %}

{% block script %}
<script>
  // ì•ˆì „í•œ í…ìŠ¤íŠ¸ ì¶œë ¥ìš©
  function escapeHTML(str){
    return (str ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // ë‹¨ê³„ë³„ í€´ì¦ˆ ë¡œì§
  let currentStep = 1;
  let answers = {
    gender: '',
    accord: '',
    time: ''
  };

  function showStep(stepNum) {
    // ëª¨ë“  ìŠ¤í… ìˆ¨ê¸°ê¸°
    document.querySelectorAll('.quiz-step').forEach(step => {
      step.style.display = 'none';
    });
    
    // í˜„ì¬ ìŠ¤í… ë³´ì—¬ì£¼ê¸°
    document.getElementById(`step-${stepNum}`).style.display = 'block';
    
    // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸
    updateProgressBar(stepNum);
  }

  function updateProgressBar(stepNum) {
    const progressFill = document.querySelector('.progress-fill');
    if (progressFill) {
      const percentage = (stepNum / 3) * 100;
      progressFill.style.width = `${percentage}%`;
    }
  }

  function nextStep() {
    if (currentStep < 3) {
      currentStep++;
      showStep(currentStep);
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      currentStep--;
      showStep(currentStep);
    }
  }

  // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì¶”ê°€ ë° ì´ˆê¸° ì„¤ì •
  document.addEventListener('DOMContentLoaded', function() {
    const quizHeader = document.querySelector('.quiz-header');
    if (quizHeader) {
      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progressBar.innerHTML = '<div class="progress-fill" style="width: 33.33%;"></div>';
      quizHeader.insertAdjacentElement('afterend', progressBar);
    }

    // í•­ìƒ ì²« ë²ˆì§¸ ë‹¨ê³„ë¶€í„° ì‹œì‘
    currentStep = 1;
    showStep(1);

    // 1ë‹¨ê³„ ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸
    document.querySelectorAll('#step-1 .quiz-option').forEach(option => {
      option.addEventListener('click', function() {
        // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('#step-1 .quiz-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        this.classList.add('selected');
        
        answers.gender = this.dataset.value;
        document.getElementById('gender-input').value = answers.gender;
        
        // 0.5ì´ˆ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ
        setTimeout(() => {
          nextStep();
        }, 500);
      });
    });

    // 2ë‹¨ê³„ ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸
    document.querySelectorAll('#step-2 .quiz-option').forEach(option => {
      option.addEventListener('click', function() {
        // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('#step-2 .quiz-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        this.classList.add('selected');
        
        answers.accord = this.dataset.value;
        document.getElementById('accord-input').value = answers.accord;
        
        // 0.5ì´ˆ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ
        setTimeout(() => {
          nextStep();
        }, 500);
      });
    });

    // 3ë‹¨ê³„ ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸
    document.querySelectorAll('#step-3 .quiz-option').forEach(option => {
      option.addEventListener('click', function() {
        // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('#step-3 .quiz-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        this.classList.add('selected');
        
        answers.time = this.dataset.value;
        document.getElementById('time-input').value = answers.time;
      });
    });

    // ì´ì „ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.querySelectorAll('.prev-btn').forEach(btn => {
      btn.addEventListener('click', prevStep);
    });
  });

  // ì›”ë“œì»µ í† ë„ˆë¨¼íŠ¸ ë¡œì§
  const CANDIDATES = {{ worldcup_candidates_json|default:"[]"|safe }};
  const startBtn = document.getElementById("wc-start");
  const stage = document.getElementById("wc-stage");
  const grid = document.getElementById("wc-candidate-grid");
  const matchBox = document.getElementById("wc-match");
  const roundLabel = document.getElementById("wc-round-label");

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  // ê°œì„ ëœ í† ë„ˆë¨¼íŠ¸ ì¹´ë“œ í…œí”Œë¦¿
  function cardHTML(item, idx){
    return `
      <div class="wc-card" data-idx="${idx}"
           style="cursor:pointer;border:3px solid #e5e7eb;border-radius:20px;overflow:hidden;background:white;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);box-shadow:0 8px 32px rgba(0,0,0,0.1);position:relative;">
        <div style="position:absolute;top:12px;left:12px;background:rgba(30,58,138,0.9);color:white;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;backdrop-filter:blur(10px);">
          ì„ íƒí•˜ì„¸ìš”
        </div>
        <div style="aspect-ratio:1/1;background:#f8fafc;overflow:hidden;">
          <img src="${item.image_url}" alt="${escapeHTML(item.brand)} ${escapeHTML(item.name)}"
               style="width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s ease;">
        </div>
        <div style="padding:20px;">
          <div style="font-weight:800;color:#1e3a8a;font-size:18px;margin-bottom:6px;line-height:1.2;">${escapeHTML(item.brand)}</div>
          <div style="color:#64748b;font-size:16px;margin-bottom:12px;line-height:1.3;">${escapeHTML(item.name)}</div>
          <div style="color:#9ca3af;font-size:13px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;line-height:1.4;">
            ${escapeHTML(item.description || "")}
          </div>
        </div>
      </div>`;
  }

  function runTournament(items){
    stage.style.display = "block";
    if (grid) grid.style.display = "none";

    let current = shuffle(items.slice());
    let round = current.length;
    let pairIdx = 0;
    let winners = [];

    function updateRoundLabel(){ 
      let roundName = '';
      switch(round) {
        case 8: roundName = '8ê°•'; break;
        case 4: roundName = 'ì¤€ê²°ìŠ¹'; break;
        case 2: roundName = 'ê²°ìŠ¹'; break;
        default: roundName = `Round ${round}`;
      }
      roundLabel.innerHTML = `<span style="color:#3b82f6;font-size:24px;">ğŸ† ${roundName}</span>`; 
    }

    function renderPair(){
      updateRoundLabel();
      const a = current[pairIdx*2];
      const b = current[pairIdx*2+1];
      matchBox.innerHTML = cardHTML(a, 0) + cardHTML(b, 1);

      [...matchBox.querySelectorAll(".wc-card")].forEach((el, i) => {
        el.addEventListener("mouseover", () => {
          el.style.transform = "translateY(-8px) scale(1.02)";
          el.style.borderColor = "#3b82f6";
          el.style.boxShadow = "0 16px 48px rgba(59,130,246,0.3)";
          el.querySelector('img').style.transform = "scale(1.05)";
        });
        
        el.addEventListener("mouseout", () => {
          el.style.transform = "translateY(0) scale(1)";
          el.style.borderColor = "#e5e7eb";
          el.style.boxShadow = "0 8px 32px rgba(0,0,0,0.1)";
          el.querySelector('img').style.transform = "scale(1)";
        });

        el.addEventListener("click", () => {
          // ì„ íƒ íš¨ê³¼
          el.style.background = "linear-gradient(135deg, #3b82f6 0%, #1e40af 100%)";
          el.style.color = "white";
          el.style.transform = "scale(1.05)";
          el.style.borderColor = "#1e40af";
          
          // ë‹¤ë¥¸ ì¹´ë“œ ë¹„í™œì„±í™”
          const otherCard = el.parentNode.querySelector('.wc-card:not([data-idx="' + i + '"])');
          if (otherCard) {
            otherCard.style.opacity = "0.5";
            otherCard.style.transform = "scale(0.95)";
          }
          
          setTimeout(() => {
            winners.push(i === 0 ? a : b);
            pairIdx++;
            if (pairIdx >= current.length/2){
              // ë¼ìš´ë“œ ì¢…ë£Œ
              if (winners.length === 1){
                // ìš°ìŠ¹
                matchBox.innerHTML = `
                  <div style="grid-column:1/-1;text-align:center;">
                    <div style="font-size:32px;font-weight:900;color:#1e3a8a;margin-bottom:24px;animation: bounce 1s infinite;">ğŸ† ìš°ìŠ¹ì ğŸ†</div>
                    <div style="max-width:400px;margin:0 auto;">
                      ${cardHTML(winners[0], 0)}
                    </div>
                    <div style="margin-top:24px;padding:20px;background:linear-gradient(135deg, #dbeafe, #bfdbfe);border-radius:16px;border:2px solid #3b82f6;">
                      <div style="color:#1e3a8a;font-size:18px;font-weight:700;">ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰</div>
                      <div style="color:#64748b;font-size:14px;margin-top:4px;">ë‹¹ì‹ ë§Œì˜ í–¥ìˆ˜ë¥¼ ì°¾ì•˜ì–´ìš”!</div>
                    </div>
                  </div>`;
                roundLabel.innerHTML = '<span style="color:#1e3a8a;font-size:28px;">ğŸ‘‘ Champion ğŸ‘‘</span>';
                return;
              }
              // ë‹¤ìŒ ë¼ìš´ë“œ
              current = winners.slice();
              winners = [];
              pairIdx = 0;
              round = current.length;
            }
            renderPair();
          }, 600);
        }, { once: true });
      });
    }
    renderPair();
  }

  if (startBtn){
    startBtn.addEventListener("click", () => {
      if (CANDIDATES.length < 2){
        alert("í›„ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ì¡°ê±´ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }
      runTournament(CANDIDATES);
    });
  }

  // ë°”ìš´ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
  const style = document.createElement('style');
  style.textContent = `
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }
  `;
  document.head.appendChild(style);
</script>
{% endblock script %}