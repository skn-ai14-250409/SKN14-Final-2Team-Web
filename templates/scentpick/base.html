{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}ScentPick{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/scentpick.css' %}?v=20250908-4">
  <style>
    /* ì¸ì¦ ê´€ë ¨ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .auth-container {
        max-width: 400px;
        margin: 50px auto;
        background: white;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #2d3748;
    }
    
    .form-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s;
        box-sizing: border-box;
    }
    
    .form-group input:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .btn-primary {
        width: 100%;
        background: #6366f1;
        color: white;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .btn-primary:hover {
        background: #5855eb;
    }
    
    .social-login {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    .social-btn {
        flex: 1;
        padding: 12px;
        border: 1px solid #e2e8f0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    
    .social-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .gender-selection {
        display: flex;
        gap: 10px;
    }
    
    .gender-btn {
        flex: 1;
        padding: 12px;
        border: 1px solid #e2e8f0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .gender-btn.selected {
        background: #6366f1;
        color: white;
        border-color: #6366f1;
    }
    
    /* ì‚¬ìš©ì ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    .user-menu {
        position: relative;
        display: inline-block;
    }
    
    .user-menu-btn {
        background: #6366f1;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .user-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        min-width: 120px;
        z-index: 1000;
    }
    
    .user-dropdown a {
        display: block;
        padding: 10px 15px;
        text-decoration: none;
        color: #2d3748;
        border-bottom: 1px solid #f7fafc;
    }
    
    .user-dropdown a:last-child {
        border-bottom: none;
        color: #e53e3e;
    }
    
    .user-dropdown a:hover {
        background-color: #f7fafc;
    }
    
    .user-info {
        color: #4a5568;
        margin-right: 15px;
        font-size: 14px;
    }
    
    .auth-links {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .auth-links a {
        text-decoration: none;
        font-weight: 500;
        font-size: 14px;
    }
    
    .login-link {
        color: #6366f1;
    }
    
    .register-link {
        background: #6366f1;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
    }
    .nav-avatar {
        width: 32px; height: 32px; border-radius: 50%;
        object-fit: cover; border: 1px solid #e2e8f0; margin-right: 8px;
        vertical-align: middle;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a class="logo" href="{% url 'scentpick:home' %}">ScentPick</a>
      <ul class="nav-menu">
        <li class="nav-item"><a class="{% if request.resolver_match.url_name == 'chat' %}active{% endif %}" href="{% url 'scentpick:chat' %}">ScentPick Chat</a></li>
        <li class="nav-item"><a class="{% if request.resolver_match.url_name == 'recommend' %}active{% endif %}" href="{% url 'scentpick:recommend' %}">Recommend</a></li>
        <li class="nav-item"><a class="{% if request.resolver_match.url_name == 'perfumes' %}active{% endif %}" href="{% url 'scentpick:perfumes' %}">Perfumes</a></li>
        <li class="nav-item"><a class="{% if request.resolver_match.url_name == 'offlines' %}active{% endif %}" href="{% url 'scentpick:offlines' %}">Offlines</a></li>
        <li class="nav-item"><a class="{% if request.resolver_match.url_name == 'mypage' %}active{% endif %}" href="{% url 'scentpick:mypage' %}">My Page</a></li>
        
        <!-- ì‚¬ìš©ì ì¸ì¦ ê´€ë ¨ ë©”ë‰´ ì¶”ê°€ -->
        <li class="nav-item nav-auth">
          {% if user.is_authenticated %}
            <img class="nav-avatar" src="{{ user.detail.avatar_url }}" alt="avatar">
            <span class="user-info">{{ user.detail.name|default:user.username }}ë‹˜</span>
            <div class="user-menu">
              <button class="user-menu-btn" id="userMenuBtn">Menu</button>
              <div class="user-dropdown" id="userDropdown">
                <a href="{% url 'scentpick:mypage' %}">ë§ˆì´í˜ì´ì§€</a>
                <a href="{% url 'uauth:logout' %}">ë¡œê·¸ì•„ì›ƒ</a>
              </div>
            </div>
          {% else %}
            <div class="auth-links">
              <a href="{% url 'uauth:login' %}" class="login-link">ë¡œê·¸ì¸</a>
              <a href="{% url 'uauth:register' %}" class="register-link">íšŒì›ê°€ì…</a>
            </div>
          {% endif %}
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main -->
  <div class="main-content">
    <div class="container">
      {% block content %}{% endblock %}
    </div>
  </div>

  <!-- Chatbot Toggle -->
  <button class="chatbot-toggle" id="chatbotToggle" title="ScentPick AI">ğŸ’¬</button>

  <!-- Chatbot Sidebar -->
  <div class="chatbot-sidebar" id="chatbotSidebar">
    <div class="chatbot-header">
      <h3>ScentPick AI</h3>
      <button class="close-chatbot" id="closeChatbot">Ã—</button>
    </div>
    <div class="sidebar-chat-messages" id="sidebarChatMessages">
      <div class="message"><div class="message-content">
        ì•ˆë…•í•˜ì„¸ìš”! í–¥ìˆ˜ ê´€ë ¨í•´ì„œ ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”!
      </div></div>
    </div>
    <div class="sidebar-chat-input">
      <input type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." id="sidebarChatInput">
      <button class="send-btn" id="sidebarSendBtn">ì „ì†¡</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-warnings">
        âš ï¸ í–¥ìˆ˜ ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­: ë³¸ ì œí’ˆì€ ì•Œë ˆë¥´ê¸° ìœ ë°œ ì„±ë¶„ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        í”¼ë¶€ì— ì´ìƒì´ ìƒê¸¸ ê²½ìš° ì‚¬ìš©ì„ ì¤‘ë‹¨í•˜ì„¸ìš”. ê°€ì—°ì„± ë¬¼ì§ˆì´ë¯€ë¡œ í™”ê¸° ê·¼ì²˜ì—ì„œ ì‚¬ìš©ì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
      </div>
      <div class="footer-copyright">
        Â© 2024 ScentPick. All rights reserved. | ë¬¸ì˜: contact@scentpick.com
      </div>
    </div>
  </footer>

  <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
  <div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;"></div>

  <script src="{% static 'js/scentpick.js' %}"></script>
  {% block script %}{% endblock script %}
  {% block scripts %}{% endblock scripts %}

  <script>
  // ì‚¬ìš©ì ë©”ë‰´ í† ê¸€
  document.addEventListener('DOMContentLoaded', function() {
      const menuBtn = document.getElementById('userMenuBtn');
      const dropdown = document.getElementById('userDropdown');
      
      if (menuBtn && dropdown) {
          menuBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
          });
          
          document.addEventListener('click', function() {
              dropdown.style.display = 'none';
          });
      }
  });

  // í† ìŠ¤íŠ¸ ì•Œë¦¼ í•¨ìˆ˜
  function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.style.cssText = `
          background: ${type === 'success' ? '#48bb78' : '#f56565'};
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          margin-bottom: 10px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          transform: translateX(100%);
          transition: transform 0.3s ease;
          max-width: 300px;
          word-wrap: break-word;
      `;
      toast.textContent = message;
      
      document.getElementById('toast-container').appendChild(toast);
      
      // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë‚˜íƒ€ë‚´ê¸°
      setTimeout(() => toast.style.transform = 'translateX(0)', 100);
      
      // 3ì´ˆ í›„ ì œê±°
      setTimeout(() => {
          toast.style.transform = 'translateX(100%)';
          setTimeout(() => toast.remove(), 300);
      }, 3000);
  }

  // Django ë©”ì‹œì§€ë¥¼ í† ìŠ¤íŠ¸ë¡œ ë³€í™˜
  {% if messages %}
      {% for message in messages %}
          showToast('{{ message|escapejs }}', '{{ message.tags }}');
      {% endfor %}
  {% endif %}
  </script>

</body>
</html>
